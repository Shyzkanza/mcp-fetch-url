---
description: Processus complet de release avec mise Ã  jour de toutes les versions
globs: 
alwaysApply: true
---

# Processus de Release - Checklist ComplÃ¨te

## ğŸš¨ RÃˆGLE CRITIQUE

**Quand l'utilisateur demande de faire une release, un hotfix, ou n'importe quelle version :**

1. â“ **TOUJOURS demander la version** : "Quelle version voulez-vous faire ?" (ex: "2.1.0 ?")
2. âœ… **Attendre confirmation** de l'utilisateur
3. âœ… **Mettre Ã  jour TOUS les fichiers** contenant la version (voir checklist ci-dessous)
4. âœ… **Mettre Ã  jour CONTEXT.md** avec le changelog
5. âœ… **CrÃ©er la MR** avec titre `Release X.Y.Z`
6. âœ… **VÃ©rifier** que tous les fichiers sont cohÃ©rents

---

## ğŸ“‹ Checklist ComplÃ¨te de Release

### Ã‰tape 1 : Demander la Version

```bash
# â“ TOUJOURS demander avant de commencer
"Quelle version voulez-vous faire ? 2.1.0 ?"
```

### Ã‰tape 2 : Mettre Ã  Jour Tous les Fichiers de Version

#### âœ… package.json
```json
{
  "version": "X.Y.Z"  // Mettre Ã  jour ici
}
```

#### âœ… src/servers/http.ts
```typescript
// Rechercher toutes les occurrences de version
server.version = 'X.Y.Z';  // Dans createMcpServer()
version: 'X.Y.Z',           // Dans /health endpoint
```

#### âœ… src/http-client.ts
```typescript
version: 'X.Y.Z',  // Si prÃ©sent
```

#### âœ… src/servers/stdio.ts
```typescript
version: 'X.Y.Z',  // Si prÃ©sent
```

#### âœ… README.md
```markdown
# Badge version (ligne 6)
[![npm version](https://img.shields.io/badge/npm-vX.Y.Z-blue)](https://www.npmjs.com/package/@shyzus/mcp-scrapidou)
```

#### âœ… CONTEXT.md
```markdown
## ğŸ“ Change History

### vX.Y.Z - YYYY-MM-DD (Titre court)

**Release Notes**
- âœ… Feature 1: description
- âœ… Feature 2: description
- âœ… Fix: bug corrigÃ©
- âœ… Update: changement

**Git**
- Commit: (sera complÃ©tÃ© aprÃ¨s commit)
- Tag: `X.Y.Z`
- Branch: `main` (merged from develop)
```

### Ã‰tape 3 : VÃ©rifier la CohÃ©rence

```bash
# VÃ©rifier que toutes les versions correspondent
grep -r "version.*:" src/ | grep -v node_modules
grep '"version"' package.json
grep "version.*badge" README.md || echo "Pas de badge version dans README"
```

### Ã‰tape 4 : Commit et MR

```bash
# Commit tous les changements
git add package.json src/**/*.ts README.md CONTEXT.md
git commit -m "chore: bump version to X.Y.Z

- Update version in package.json
- Update version in src/servers/http.ts
- Update version in src/http-client.ts
- Update version in src/servers/stdio.ts
- Update README.md badge version
- Update CONTEXT.md changelog"

# CrÃ©er la MR (titre OBLIGATOIRE)
# Titre: "Release X.Y.Z"
```

### Ã‰tape 5 : AprÃ¨s Validation MR

```bash
# Merge dans main (merge ou squash selon choix)
git checkout main
git merge develop  # ou git merge --squash develop

# CrÃ©er tag
git tag X.Y.Z -m "Release X.Y.Z"

# Push
git push origin main
git push origin X.Y.Z

# Synchroniser develop
git checkout develop
git merge main
git push origin develop
```

---

## ğŸ” Fichiers Ã  VÃ©rifier par Projet

### mcp-fetch-url-spe
- âœ… `package.json` â†’ `"version"`
- âœ… `src/servers/http.ts` â†’ `server.version` et `/health`
- âœ… `src/http-client.ts` â†’ `version`
- âœ… `src/servers/stdio.ts` â†’ `version`
- âœ… `README.md` â†’ Badge version (si prÃ©sent)
- âœ… `CONTEXT.md` â†’ Changelog

### mcp-fetch-url
- âœ… `package.json` â†’ `"version"`
- âœ… `src/servers/http.ts` â†’ `server.version` et `/health`
- âœ… `src/http-client.ts` â†’ `version`
- âœ… `src/servers/stdio.ts` â†’ `version`
- âœ… `README.md` â†’ Badge `[![npm version]` (ligne 6)
- âœ… `CONTEXT.md` â†’ Changelog

---

## âš ï¸ Erreurs Courantes Ã  Ã‰viter

1. âŒ **Oublier de demander la version** â†’ TOUJOURS demander d'abord
2. âŒ **Mettre Ã  jour package.json mais pas les fichiers src/** â†’ VÃ©rifier tous les fichiers
3. âŒ **Oublier le badge README.md** â†’ VÃ©rifier si badge prÃ©sent
4. âŒ **Oublier CONTEXT.md changelog** â†’ TOUJOURS mettre Ã  jour
5. âŒ **Tag avec "v"** â†’ Tag = `X.Y.Z` (sans "v")
6. âŒ **Titre MR incorrect** â†’ DOIT Ãªtre `Release X.Y.Z`

---

## ğŸ“ Template de Commit Message

```
chore: bump version to X.Y.Z

- Update version in package.json
- Update version in src/servers/http.ts
- Update version in src/http-client.ts
- Update version in src/servers/stdio.ts
- Update README.md badge version (if present)
- Update CONTEXT.md changelog
```

---

## âœ… Validation Finale

Avant de crÃ©er la MR, vÃ©rifier :

```bash
# 1. Toutes les versions sont identiques
VERSION=$(node -p "require('./package.json').version")
echo "Version dans package.json: $VERSION"
grep -r "version.*'$VERSION'" src/ || echo "âš ï¸ VÃ©rifier les versions dans src/"

# 2. CONTEXT.md est Ã  jour
grep "### v$VERSION" CONTEXT.md || echo "âš ï¸ Ajouter changelog dans CONTEXT.md"

# 3. README.md badge (si prÃ©sent)
grep "v$VERSION" README.md || echo "â„¹ï¸ Pas de badge version dans README.md"

# 4. On est sur develop
git branch --show-current | grep develop || echo "âš ï¸ On doit Ãªtre sur develop"
```
